py_binary(
    name = "generator",
    srcs = ["schemata/generator.py"],
    visibility = ["//visibility:public"],
    deps = [
        "@my_deps//jinja2",
        "@my_deps//jsonschema",
    ],
)

genrule(
    name = "proto_srcs",
    srcs = [
        "schemata/api_versions_request.json",
        "schemata/api_versions_response.json",
        "schemata/offset_fetch_request.json",
        "schemata/offset_fetch_response.json",
        "schemata/offset_commit_request.json",
        "schemata/offset_commit_response.json",
        "schemata/join_group_request.json",
        "schemata/join_group_response.json",
        "schemata/sync_group_request.json",
        "schemata/sync_group_response.json",
        "schemata/heartbeat_request.json",
        "schemata/heartbeat_response.json",
        "schemata/leave_group_request.json",
        "schemata/leave_group_response.json",
        "schemata/delete_topics_request.json",
        "schemata/delete_topics_response.json",
        "schemata/describe_configs_request.json",
        "schemata/describe_configs_response.json",
        "schemata/find_coordinator_request.json",
        "schemata/find_coordinator_response.json",
        "schemata/list_offset_request.json",
        "schemata/list_offset_response.json",
        "schemata/list_transactions_request.json",
        "schemata/list_transactions_response.json",
        "schemata/alter_configs_request.json",
        "schemata/alter_configs_response.json",
        "schemata/list_groups_request.json",
        "schemata/list_groups_response.json",
        "schemata/describe_groups_request.json",
        "schemata/describe_groups_response.json",
        "schemata/create_topics_request.json",
        "schemata/create_topics_response.json",
        "schemata/sasl_handshake_request.json",
        "schemata/sasl_handshake_response.json",
        "schemata/sasl_authenticate_request.json",
        "schemata/sasl_authenticate_response.json",
        "schemata/init_producer_id_request.json",
        "schemata/init_producer_id_response.json",
        "schemata/incremental_alter_configs_request.json",
        "schemata/incremental_alter_configs_response.json",
        "schemata/delete_groups_request.json",
        "schemata/delete_groups_response.json",
        "schemata/describe_acls_request.json",
        "schemata/describe_acls_response.json",
        "schemata/describe_log_dirs_request.json",
        "schemata/describe_log_dirs_response.json",
        "schemata/describe_producers_request.json",
        "schemata/describe_producers_response.json",
        "schemata/describe_transactions_request.json",
        "schemata/describe_transactions_response.json",
        "schemata/create_acls_request.json",
        "schemata/create_acls_response.json",
        "schemata/delete_acls_request.json",
        "schemata/delete_acls_response.json",
        "schemata/produce_request.json",
        "schemata/produce_response.json",
        "schemata/metadata_request.json",
        "schemata/metadata_response.json",
        "schemata/add_partitions_to_txn_request.json",
        "schemata/add_partitions_to_txn_response.json",
        "schemata/txn_offset_commit_request.json",
        "schemata/txn_offset_commit_response.json",
        "schemata/fetch_request.json",
        "schemata/fetch_response.json",
        "schemata/end_txn_request.json",
        "schemata/end_txn_response.json",
        "schemata/create_partitions_request.json",
        "schemata/create_partitions_response.json",
        "schemata/add_offsets_to_txn_request.json",
        "schemata/add_offsets_to_txn_response.json",
        "schemata/offset_delete_request.json",
        "schemata/offset_delete_response.json",
        "schemata/delete_records_request.json",
        "schemata/delete_records_response.json",
        "schemata/offset_for_leader_epoch_request.json",
        "schemata/offset_for_leader_epoch_response.json",
        "schemata/alter_partition_reassignments_request.json",
        "schemata/alter_partition_reassignments_response.json",
        "schemata/list_partition_reassignments_request.json",
        "schemata/list_partition_reassignments_response.json",
        "schemata/alter_client_quotas_request.json",
        "schemata/alter_client_quotas_response.json",
        "schemata/describe_client_quotas_request.json",
        "schemata/describe_client_quotas_response.json",
    ],
    outs = [
        "schemata/api_versions_request.h",
        "schemata/api_versions_response.h",
        "schemata/offset_fetch_request.h",
        "schemata/offset_fetch_response.h",
        "schemata/offset_commit_request.h",
        "schemata/offset_commit_response.h",
        "schemata/join_group_request.h",
        "schemata/join_group_response.h",
        "schemata/sync_group_request.h",
        "schemata/sync_group_response.h",
        "schemata/heartbeat_request.h",
        "schemata/heartbeat_response.h",
        "schemata/leave_group_request.h",
        "schemata/leave_group_response.h",
        "schemata/delete_topics_request.h",
        "schemata/delete_topics_response.h",
        "schemata/describe_configs_request.h",
        "schemata/describe_configs_response.h",
        "schemata/find_coordinator_request.h",
        "schemata/find_coordinator_response.h",
        "schemata/list_offset_request.h",
        "schemata/list_offset_response.h",
        "schemata/list_transactions_request.h",
        "schemata/list_transactions_response.h",
        "schemata/alter_configs_request.h",
        "schemata/alter_configs_response.h",
        "schemata/list_groups_request.h",
        "schemata/list_groups_response.h",
        "schemata/describe_groups_request.h",
        "schemata/describe_groups_response.h",
        "schemata/create_topics_request.h",
        "schemata/create_topics_response.h",
        "schemata/sasl_handshake_request.h",
        "schemata/sasl_handshake_response.h",
        "schemata/sasl_authenticate_request.h",
        "schemata/sasl_authenticate_response.h",
        "schemata/init_producer_id_request.h",
        "schemata/init_producer_id_response.h",
        "schemata/incremental_alter_configs_request.h",
        "schemata/incremental_alter_configs_response.h",
        "schemata/delete_groups_request.h",
        "schemata/delete_groups_response.h",
        "schemata/describe_acls_request.h",
        "schemata/describe_acls_response.h",
        "schemata/describe_log_dirs_request.h",
        "schemata/describe_log_dirs_response.h",
        "schemata/describe_producers_request.h",
        "schemata/describe_producers_response.h",
        "schemata/describe_transactions_request.h",
        "schemata/describe_transactions_response.h",
        "schemata/create_acls_request.h",
        "schemata/create_acls_response.h",
        "schemata/delete_acls_request.h",
        "schemata/delete_acls_response.h",
        "schemata/produce_request.h",
        "schemata/produce_response.h",
        "schemata/metadata_request.h",
        "schemata/metadata_response.h",
        "schemata/add_partitions_to_txn_request.h",
        "schemata/add_partitions_to_txn_response.h",
        "schemata/txn_offset_commit_request.h",
        "schemata/txn_offset_commit_response.h",
        "schemata/fetch_request.h",
        "schemata/fetch_response.h",
        "schemata/end_txn_request.h",
        "schemata/end_txn_response.h",
        "schemata/create_partitions_request.h",
        "schemata/create_partitions_response.h",
        "schemata/add_offsets_to_txn_request.h",
        "schemata/add_offsets_to_txn_response.h",
        "schemata/offset_delete_request.h",
        "schemata/offset_delete_response.h",
        "schemata/delete_records_request.h",
        "schemata/delete_records_response.h",
        "schemata/offset_for_leader_epoch_request.h",
        "schemata/offset_for_leader_epoch_response.h",
        "schemata/alter_partition_reassignments_request.h",
        "schemata/alter_partition_reassignments_response.h",
        "schemata/list_partition_reassignments_request.h",
        "schemata/list_partition_reassignments_response.h",
        "schemata/alter_client_quotas_request.h",
        "schemata/alter_client_quotas_response.h",
        "schemata/describe_client_quotas_request.h",
        "schemata/describe_client_quotas_response.h",
        "protocol.cc",
    ],
    cmd = "$(location :generator) $(SRCS) $(OUTS)",
    tools = [":generator"],
)

cc_library(
    name = "protocol",
    srcs = [
        "batch_reader.cc",
        "errors.cc",
        "kafka_batch_adapter.cc",
        "logger.cc",
        "protocol.cc",
        "types.cc",
    ],
    hdrs = [
        "add_offsets_to_txn.h",
        "add_partitions_to_txn.h",
        "alter_client_quotas.h",
        "alter_configs.h",
        "alter_partition_reassignments.h",
        "api_versions.h",
        "batch_consumer.h",
        "batch_reader.h",
        "create_acls.h",
        "create_partitions.h",
        "create_topics.h",
        "delete_acls.h",
        "delete_groups.h",
        "delete_records.h",
        "delete_topics.h",
        "describe_acls.h",
        "describe_client_quotas.h",
        "describe_configs.h",
        "describe_groups.h",
        "describe_log_dirs.h",
        "describe_producers.h",
        "describe_transactions.h",
        "end_txn.h",
        "errors.h",
        "exceptions.h",
        "fetch.h",
        "find_coordinator.h",
        "flex_versions.h",
        "fwd.h",
        "heartbeat.h",
        "incremental_alter_configs.h",
        "init_producer_id.h",
        "join_group.h",
        "kafka_batch_adapter.h",
        "leave_group.h",
        "legacy_message.h",
        "list_groups.h",
        "list_offsets.h",
        "list_partition_reassignments.h",
        "list_transactions.h",
        "logger.h",
        "metadata.h",
        "offset_commit.h",
        "offset_delete.h",
        "offset_fetch.h",
        "offset_for_leader_epoch.h",
        "produce.h",
        "sasl_authenticate.h",
        "sasl_handshake.h",
        "schemata/add_offsets_to_txn_request.h",
        "schemata/add_offsets_to_txn_response.h",
        "schemata/add_partitions_to_txn_request.h",
        "schemata/add_partitions_to_txn_response.h",
        "schemata/alter_client_quotas_request.h",
        "schemata/alter_client_quotas_response.h",
        "schemata/alter_configs_request.h",
        "schemata/alter_configs_response.h",
        "schemata/alter_partition_reassignments_request.h",
        "schemata/alter_partition_reassignments_response.h",
        "schemata/api_versions_request.h",
        "schemata/api_versions_response.h",
        "schemata/create_acls_request.h",
        "schemata/create_acls_response.h",
        "schemata/create_partitions_request.h",
        "schemata/create_partitions_response.h",
        "schemata/create_topics_request.h",
        "schemata/create_topics_response.h",
        "schemata/delete_acls_request.h",
        "schemata/delete_acls_response.h",
        "schemata/delete_groups_request.h",
        "schemata/delete_groups_response.h",
        "schemata/delete_records_request.h",
        "schemata/delete_records_response.h",
        "schemata/delete_topics_request.h",
        "schemata/delete_topics_response.h",
        "schemata/describe_acls_request.h",
        "schemata/describe_acls_response.h",
        "schemata/describe_client_quotas_request.h",
        "schemata/describe_client_quotas_response.h",
        "schemata/describe_configs_request.h",
        "schemata/describe_configs_response.h",
        "schemata/describe_groups_request.h",
        "schemata/describe_groups_response.h",
        "schemata/describe_log_dirs_request.h",
        "schemata/describe_log_dirs_response.h",
        "schemata/describe_producers_request.h",
        "schemata/describe_producers_response.h",
        "schemata/describe_transactions_request.h",
        "schemata/describe_transactions_response.h",
        "schemata/end_txn_request.h",
        "schemata/end_txn_response.h",
        "schemata/fetch_request.h",
        "schemata/fetch_response.h",
        "schemata/find_coordinator_request.h",
        "schemata/find_coordinator_response.h",
        "schemata/heartbeat_request.h",
        "schemata/heartbeat_response.h",
        "schemata/incremental_alter_configs_request.h",
        "schemata/incremental_alter_configs_response.h",
        "schemata/init_producer_id_request.h",
        "schemata/init_producer_id_response.h",
        "schemata/join_group_request.h",
        "schemata/join_group_response.h",
        "schemata/leave_group_request.h",
        "schemata/leave_group_response.h",
        "schemata/list_groups_request.h",
        "schemata/list_groups_response.h",
        "schemata/list_offset_request.h",
        "schemata/list_offset_response.h",
        "schemata/list_partition_reassignments_request.h",
        "schemata/list_partition_reassignments_response.h",
        "schemata/list_transactions_request.h",
        "schemata/list_transactions_response.h",
        "schemata/metadata_request.h",
        "schemata/metadata_response.h",
        "schemata/offset_commit_request.h",
        "schemata/offset_commit_response.h",
        "schemata/offset_delete_request.h",
        "schemata/offset_delete_response.h",
        "schemata/offset_fetch_request.h",
        "schemata/offset_fetch_response.h",
        "schemata/offset_for_leader_epoch_request.h",
        "schemata/offset_for_leader_epoch_response.h",
        "schemata/produce_request.h",
        "schemata/produce_response.h",
        "schemata/sasl_authenticate_request.h",
        "schemata/sasl_authenticate_response.h",
        "schemata/sasl_handshake_request.h",
        "schemata/sasl_handshake_response.h",
        "schemata/sync_group_request.h",
        "schemata/sync_group_response.h",
        "schemata/txn_offset_commit_request.h",
        "schemata/txn_offset_commit_response.h",
        "sync_group.h",
        "timeout.h",
        "txn_offset_commit.h",
        "types.h",
        "wire.h",
    ],
    include_prefix = "kafka/protocol",
    visibility = ["//visibility:public"],
    deps = [
        "//src/v/base",
        "//src/v/bytes",
        "//src/v/kafka:types",
        "//src/v/model",
        "//src/v/ssx",
        "//src/v/storage:record_batch_builder",
        "//src/v/utils",
        "@seastar//:libseastar",
    ],
)

# seems like this will go into the server
# "flex_versions.h",
# "flex_versions.cc",

#${message_hdrs}
#${msg_src}
